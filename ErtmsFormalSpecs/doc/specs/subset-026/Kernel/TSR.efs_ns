<NameSpace
 X="990"
 Y="420"
 Width="100"
 Height="50"
 Pinned="TRUE"
 Name="TSR"
 Guid="ddbb76e4-1952-4bfd-99d6-732ca3bbe208"
>
<NameSpaces>
</NameSpaces>
<Structures>
<Structure
 Default=""
 Implemented="TRUE"
 Name="TemporarySpeedRestriction"
 Guid="0750c483-234a-40dc-ad60-7476fe9389a6"
>
<ReqRef
 Id="0ef0898e-cf23-489a-a1ec-efefda2bff98"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="c6c6f4db-0a3a-40f5-b1d1-70aec200120a"
>
<Comment></Comment>
</ReqRef><ReqRef
 Id="2d4205fe-a62e-4306-88c0-fa8ed50b9d93"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="2e010dff-05cf-4954-b8f4-2b876b8a1745"
>
<Comment></Comment>
</ReqRef><ReqRef
 Id="d925afa7-0975-42ee-8f81-820493dda041"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="27276eb9-a0ae-4e0c-a772-f2bb6f72d434"
>
</ReqRef><ReqRef
 Id="b5f18a88-808f-47eb-8d48-7a9e213ab086"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="5ae8bd33-43f5-4d68-b766-4f9de32b71d5"
>
</ReqRef><Comment>Represents a temporary speed restriction.</Comment>
<StructureElement
 TypeName="Default.BaseTypes.Distance"
 Default=""
 Mode="Internal"
 Implemented="TRUE"
 Name="Location"
 Guid="fa65122e-81e3-4722-9251-f8fd05147990"
>
<ReqRef
 Id="ff58fb6c-9219-4719-b50b-d1e185f06137"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="1e4364f6-faa5-4a22-962c-91ca6283a51e"
>
<Comment></Comment>
</ReqRef><Comment>Distance to beginning of temporary speed restriction.</Comment>
</StructureElement><StructureElement
 TypeName="Default.BaseTypes.Length"
 Default=""
 Mode="Internal"
 Implemented="TRUE"
 Name="Length"
 Guid="a99d05ae-0c23-49d9-bc9d-9cdff9f878a0"
>
<ReqRef
 Id="33595950-84c6-4825-bcab-bfdc5c53742c"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="2879ccf3-d708-4159-b6c5-351b35a85660"
>
</ReqRef><Comment>The length of the temporary speed restriction.</Comment>
</StructureElement><StructureElement
 TypeName="Default.BaseTypes.Speed"
 Default="0.0"
 Mode="Internal"
 Implemented="TRUE"
 NeedsRequirement="FALSE"
 Name="Speed"
 Guid="76391385-799e-47fa-b07f-107948f09cf1"
>
<ReqRef
 Id="c6f1fbe8-ebe1-4587-95c7-5eefd09cf5cb"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="fe01f13b-f137-466c-b5c6-94743a234a07"
>
</ReqRef><Comment>Permitted speed for the temporary speed restriction.</Comment>
</StructureElement><StructureElement
 TypeName="Messages.NID_TSR"
 Default=""
 Mode="Internal"
 Implemented="TRUE"
 Name="Id"
 Guid="ef629607-b016-4ae7-a6ba-2777e44fe702"
>
<ReqRef
 Id="1c1c2dc5-c171-456d-9a54-a4480effe5a4"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="4ca85d24-1df1-437b-a998-1e2d1757dc54"
>
<Comment></Comment>
</ReqRef><ReqRef
 Id="791d81bb-d47e-4805-901f-1ced394ba425"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="ab8590c6-22a4-48b2-838a-22ecbaf732ed"
>
</ReqRef><Comment>Represents the identity number of a temporary speed restriction. If id == 255 the temporary speed restriction in not revocable.</Comment>
</StructureElement><StructureElement
 TypeName="Messages.Q_FRONT"
 Default="Messages.Q_FRONT.No_train_length_delay_on_validity_end_point_of_profile_element"
 Mode="Internal"
 Implemented="TRUE"
 Name="TrainLengthDelay"
 Guid="8a3af3f9-bc47-4f3a-960d-9a779e9536ce"
>
<ReqRef
 Id="3dd078b7-9ad0-407d-a57a-510c8a7213ad"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="03952a47-dbb7-43cc-b3e8-fac317832fa1"
>
</ReqRef><ReqRef
 Id="49595724-3359-4536-a90e-542bc90ffc8e"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="c4311166-5b6f-4c69-bdba-92cbb2199306"
>
<Comment></Comment>
</ReqRef><ReqRef
 Id="4721d317-67ec-4171-b836-61c80b2d2d4c"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="3e7092a5-d2d4-40ef-9c8e-24e19617f628"
>
</ReqRef><Comment>Indicates if a speed limit given for a profile element is to be applied until the front end of the train or the end of the train has left the element.</Comment>
</StructureElement><StructureElement
 TypeName="Messages.NID_BG"
 Default=""
 Mode="Internal"
 Implemented="TRUE"
 NeedsRequirement="FALSE"
 Name="LRBG"
 Guid="983450d1-9e76-46d7-a986-2ba9fa71105b"
>
<Comment>Indicates the id of the balise group to which is related the distance of the temporary speed restriction.</Comment>
</StructureElement></Structure></Structures>
<Collections>
<Collection
 TypeName="TemporarySpeedRestriction"
 MaxSize="30"
 Default="[]"
 Implemented="TRUE"
 Name="TemporarySpeedRestrictions"
 Guid="63974d27-672e-4fb3-a039-1a4744c7805b"
>
<ReqRef
 Id="3b4583a1-b075-4b17-875f-25dea9123397"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="b7d566d4-aff1-4644-8ad3-2a00e3f37db6"
>
</ReqRef><ReqRef
 Id="2b873c77-fe37-4efb-bbb9-7f6570ed6a6f"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="68c47679-d687-4647-a45d-93d4d3d8640c"
>
</ReqRef><Comment></Comment>
</Collection></Collections>
<Functions>
<Function
 Type="Default.BaseTypes.Length"
 Default=""
 Implemented="TRUE"
 Name="TSRLength"
 Guid="e1f7e134-d7fc-432e-a021-fead8af82896"
>
<ReqRef
 Id="3dd078b7-9ad0-407d-a57a-510c8a7213ad"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="a8b15bae-f666-4a24-be03-98a162b77703"
>
</ReqRef><ReqRef
 Id="49595724-3359-4536-a90e-542bc90ffc8e"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="74ee6341-28e7-49c9-9cbc-51a2584af1d0"
>
</ReqRef><Comment>Provides the length of the TSR together with the train length, if needed.</Comment>
<Parameters>
<Parameter
 Type="TemporarySpeedRestriction"
 Name="aTSR"
 Guid="097815c3-cfa6-425d-ab38-d890087e4e4a"
>
</Parameter></Parameters>
<Cases>
<Case
 Name="TrainLengthDelay"
 Guid="70ff0285-9521-467e-8240-5fb456163dd1"
>
<PreConditions>
<PreCondition
 Guid="6b703005-5e73-40d0-9244-69bcfd64d6e1"
>aTSR.TrainLengthDelay == Messages.Q_FRONT.Train_length_delay_on_validity_end_point_of_profile_element</PreCondition></PreConditions>
<Expression>aTSR.Length + Kernel.TrainData.TrainData.Value.TrainLength</Expression>
</Case><Case
 Name="NoTrainLengthDelay"
 Guid="0dfc10c1-6c15-4e27-beb3-738ad1c6438f"
>
<Expression>aTSR.Length</Expression>
</Case></Cases>
</Function><Function
 Type="Default.BaseTypes.Speed"
 Default=""
 Implemented="TRUE"
 NeedsRequirement="FALSE"
 Name="TSRSpeedRestriction"
 Guid="e33d9bbb-e46d-48b5-97f6-4a18958a40cd"
>
<Comment>Provides the speed profile due to a temporary speed restriction.</Comment>
<Parameters>
<Parameter
 Type="TemporarySpeedRestriction"
 Name="aTSR"
 Guid="10f45ceb-0964-4057-b4b4-db722921f7c6"
>
</Parameter><Parameter
 Type="Default.BaseTypes.Distance"
 Name="Distance"
 Guid="3b640212-2e29-4463-af3f-b8c2e6c3e971"
>
</Parameter></Parameters>
<Cases>
<Case
 Name="During TSR"
 Guid="68d1cd35-c25e-4456-9a99-71b6f0a0e184"
>
<PreConditions>
<PreCondition
 Guid="b7a253b5-8d72-419d-b004-0e91ee5b211b"
>aTSR.Location &lt;= Distance</PreCondition><PreCondition
 Guid="7945a00b-4cbe-4c32-a198-307485b22c6d"
>Distance &lt; aTSR.Location + Default.BaseTypes.LengthToDistance(TSRLength (aTSR))</PreCondition></PreConditions>
<Expression>aTSR.Speed</Expression>
</Case><Case
 Name="Outside TSR"
 Guid="ed9eaa75-f248-490d-86b9-8eca62135a63"
>
<Expression>BaseTypes.Speed.MaxSpeed</Expression>
</Case></Cases>
</Function><Function
 Type="Default.BaseTypes.Speed"
 Default=""
 Implemented="TRUE"
 Name="SpeedRestrictions"
 Guid="3aa45245-3edf-4e8e-81b4-37889a104200"
>
<ReqRef
 Id="3b4583a1-b075-4b17-875f-25dea9123397"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="9ec2d5d4-9e08-46e2-81b4-ffa581a0109a"
>
</ReqRef><ReqRef
 Id="92457ea4-c640-4322-bf2c-027115a572b4"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="97ebaa83-4b95-4fa6-b8b3-290a746caf2a"
>
</ReqRef><ReqRef
 Id="d925afa7-0975-42ee-8f81-820493dda041"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="db582277-75dd-4d1d-9321-cea4795ad120"
>
</ReqRef><ReqRef
 Id="b2a3ff3a-3f41-4dde-9bf8-ee649ce14d86"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="23dd182d-db5d-4e6e-aab1-278120714a52"
>
</ReqRef><ReqRef
 Id="bfa09769-fb03-456f-b92b-14ab4cf7977b"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="be90c66d-f1ab-45d0-b5a7-a1046f9c0e3f"
>
</ReqRef><Comment>Provides the speed restrictions profile due to TSR.</Comment>
<Parameters>
<Parameter
 Type="Default.BaseTypes.Distance"
 Name="Distance"
 Guid="c777658e-bc8d-4434-9bd4-80c1930ed9e8"
>
</Parameter></Parameters>
<Cases>
<Case
 Name="Value"
 Guid="5e3671a8-145b-436f-897c-425e53b4e138"
>
<Expression>(REDUCE TSRs 
    USING  
        MIN ( First =&gt; FUNCTION d : Default.BaseTypes.Distance =&gt; TSRSpeedRestriction( aTSR =&gt; X, Distance =&gt; d ), 
                  Second =&gt; RESULT )
INITIAL_VALUE BaseTypes.MaxSpeedFunction) (Distance)</Expression>
</Case></Cases>
</Function><Function
 Type="Boolean"
 Default=""
 Implemented="TRUE"
 NeedsRequirement="FALSE"
 Name="CurrentTargetDueToTSR"
 Guid="0713644a-6fc8-41fb-8854-89fba1bc7797"
>
<ReqRef
 Id="5388dd34-33be-4b31-90c1-ec3bc653ccd4"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="871452f2-60a0-49d0-b6dd-7cbc43fba3cc"
>
</ReqRef><Comment>Indicates that the current target takes a TSR in consideration</Comment>
<Cases>
<Case
 Name="Always"
 Guid="5ebe6a9a-6fe4-4578-b828-6c0b14bd1b4a"
>
<Expression>THERE_IS_IN TSRs</Expression>
</Case></Cases>
</Function></Functions>
<Procedures>
<Procedure
 Implemented="TRUE"
 Name="TemporarySpeedRestrictionRevocationReceived"
 Guid="e6b0c4a8-febd-45d7-907d-29b33b7057ea"
>
<ReqRef
 Id="1c1c2dc5-c171-456d-9a54-a4480effe5a4"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="52f22579-0055-4c17-8a05-b71f48bbb8b6"
>
</ReqRef><ReqRef
 Id="609c3b11-43bc-4419-aaad-ec6b332308ba"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="d904c16f-7993-4a46-b8ea-b6b6f451d3b5"
>
</ReqRef><Comment></Comment>
<Parameters>
<Parameter
 Type="Messages.PACKET.TRACK_TO_TRAIN.TEMPORARY_SPEED_RESTRICTION_REVOCATION.Message"
 Name="Packet"
 Guid="51ffa0fe-bcbd-40fa-bb82-af77138b1ab8"
>
</Parameter><Parameter
 Type="Messages.NID_BG"
 Name="NID_BG"
 Guid="a1f1dbbe-65c1-42d2-ab0d-cdd225e3feb9"
>
</Parameter></Parameters>
<Rules>
<Rule
 Priority="UpdateINTERNAL"
 Implemented="TRUE"
 NeedsRequirement="FALSE"
 Name="RemoveTSR"
 Guid="2ed732d8-f4d7-4bbc-9d28-fe407a288f7b"
>
<SubRules></SubRules>
<Conditions>
<RuleCondition
 Implemented="TRUE"
 Name="RemoveTSR"
 Guid="ae999234-404f-4b6b-bf03-b11484dcb1fb"
>
<PreConditions>
</PreConditions>
<Actions>
<Action
 Guid="04d2a1fb-9dda-4174-9850-8ac8872b486a"
>REMOVE ALL X.Id == Packet.NID_TSR  IN TSRs</Action></Actions>
</RuleCondition></Conditions>
</Rule></Rules>
</Procedure><Procedure
 Implemented="TRUE"
 Name="TemporarySpeedRestrictionsReceived"
 Guid="057ee8b6-8311-46e7-9483-29c14adc26c5"
>
<ReqRef
 Id="0ef0898e-cf23-489a-a1ec-efefda2bff98"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="993e1e4e-02a4-43e0-88bc-0bdef35f978e"
>
</ReqRef><ReqRef
 Id="0b1bccdc-d6e1-4297-8b07-8f17f74db4cd"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="99c4878e-3131-4643-813e-5251c1bb6d38"
>
</ReqRef><Comment></Comment>
<Parameters>
<Parameter
 Type="Messages.PACKET.TRACK_TO_TRAIN.TEMPORARY_SPEED_RESTRICTION.Message"
 Name="Packet"
 Guid="6810735f-1a43-4f03-bb7d-7e67d6053887"
>
</Parameter><Parameter
 Type="Messages.NID_BG"
 Name="NID_BG"
 Guid="6f7d6f72-bfb5-4350-993e-b0e00f29b14e"
>
</Parameter></Parameters>
<Rules>
<Rule
 Priority="UpdateINTERNAL"
 Implemented="TRUE"
 NeedsRequirement="FALSE"
 Name="UpdateTSRInformation"
 Guid="81d5f47e-6f7e-4e04-a4fe-6f90cbf6b246"
>
<ReqRef
 Id="791d81bb-d47e-4805-901f-1ced394ba425"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="7d1950c6-208a-4702-b1e3-f85aeadd95c2"
>
</ReqRef><ReqRef
 Id="33595950-84c6-4825-bcab-bfdc5c53742c"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="cec00ca0-72ca-4a75-8e1f-43a9187d1c20"
>
</ReqRef><ReqRef
 Id="ff58fb6c-9219-4719-b50b-d1e185f06137"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="3f193f77-b467-427f-bcd6-ad7b0ccc95a4"
>
</ReqRef><ReqRef
 Id="c6f1fbe8-ebe1-4587-95c7-5eefd09cf5cb"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="49ab9cd5-dedc-4a6e-9aaf-5bcd140be261"
>
</ReqRef><SubRules></SubRules>
<Conditions>
<RuleCondition
 Implemented="TRUE"
 Name="ExistingRestriction"
 Guid="6bfa93e6-081b-478b-8313-b88fcf69b0d5"
>
<ReqRef
 Id="0b1bccdc-d6e1-4297-8b07-8f17f74db4cd"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="94b89c6a-6a78-4b81-842e-0ff4ccdd628a"
>
</ReqRef><ReqRef
 Id="791d81bb-d47e-4805-901f-1ced394ba425"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="fdc1c04d-f990-4f99-80d2-62603dfd385f"
>
</ReqRef><PreConditions>
<PreCondition
 Guid="713b3f3c-98bb-481a-8a50-d873d96e317d"
>THERE_IS_IN TSRs | X.Id == Packet.NID_TSR</PreCondition><PreCondition
 Guid="d5d60f09-0748-4754-a025-1753e9c07ecc"
>Packet.NID_TSR != Messages.NID_TSR.Non_revocable_speed_restriction__applicable_for_all_transmission_media</PreCondition></PreConditions>
<Actions>
<Action
 Guid="6aae0012-7c33-43ab-9241-2cf3ed58635a"
>REPLACE X.Id == Packet.NID_TSR IN TSRs BY TemporarySpeedRestriction
{
    Id =&gt; Packet.NID_TSR,
    Length =&gt; Default.MessageTypes.QScaleLength ( length =&gt; Packet.L_TSR, scale =&gt; Packet.Q_SCALE ),
    Location =&gt; Default.MessageTypes.QScaleDistance ( distance =&gt; Packet.D_TSR, scale =&gt; Packet.Q_SCALE ),
    LRBG =&gt; NID_BG,
    Speed =&gt; Default.MessageTypes.SpeedResolution ( speed =&gt; Packet.V_TSR, resolution =&gt; 5.0 ),
    TrainLengthDelay =&gt; Packet.Q_FRONT
}</Action></Actions>
</RuleCondition><RuleCondition
 Implemented="TRUE"
 Name="NewRestriction"
 Guid="6881f177-d2cf-4db7-8737-be94a29ff54e"
>
<ReqRef
 Id="f7e20aa8-abb8-4da2-bb20-5ff57e4a56b9"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="2a25b39e-deb5-42d6-ae5e-992436d7524c"
>
</ReqRef><ReqRef
 Id="3b4583a1-b075-4b17-875f-25dea9123397"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="4fdf45bf-2024-4a67-a634-432dd197133b"
>
</ReqRef><PreConditions>
</PreConditions>
<Actions>
<Action
 Guid="f094bc0f-7070-4318-a782-45b27a7ee26d"
>INSERT TemporarySpeedRestriction
{
    Id =&gt; Packet.NID_TSR,
    Length =&gt; Default.MessageTypes.QScaleLength ( length =&gt; Packet.L_TSR, scale =&gt; Packet.Q_SCALE ),
    Location =&gt; Default.MessageTypes.QScaleDistance ( distance =&gt; Packet.D_TSR, scale =&gt; Packet.Q_SCALE ),
    LRBG =&gt; NID_BG,
    Speed =&gt; Default.MessageTypes.SpeedResolution ( speed =&gt; Packet.V_TSR, resolution =&gt; 5.0 ),
    TrainLengthDelay =&gt; Packet.Q_FRONT
}
IN TSRs</Action></Actions>
</RuleCondition></Conditions>
</Rule></Rules>
</Procedure></Procedures>
<Variables>
<Variable
 Type="TemporarySpeedRestrictions"
 DefaultValue=""
 VariableMode="Internal"
 Implemented="TRUE"
 Name="TSRs"
 Guid="366fea33-392b-4a4f-bab2-2fa0a7ea3e96"
>
<ReqRef
 Id="3b4583a1-b075-4b17-875f-25dea9123397"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="2c9c004b-d0df-4f09-a67b-b792485e2cc7"
>
</ReqRef><ReqRef
 Id="d925afa7-0975-42ee-8f81-820493dda041"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="5b461edc-ebd6-4324-9afa-e4c2322c56c9"
>
</ReqRef><ReqRef
 Id="37cb1c8d-6ea0-43c6-85a9-6ce724bf590e"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="75892b66-a798-49f6-9554-56e40af995f4"
>
</ReqRef><Comment>Represents the temporary speed restrictions received from the trackside.</Comment>
</Variable></Variables>
<Rules>
<Rule
 Priority="CleanUp"
 Implemented="TRUE"
 Name="RevokeTSR"
 Guid="4341d3f8-e3a8-4c10-8526-83870ab6daec"
>
<ReqRef
 Id="2c3a1b3f-8686-4dc8-b3cb-bf0f5c7a0f03"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="0b3a8a24-a6d4-4a69-b73d-e917c55f355f"
>
</ReqRef><ReqRef
 Id="ae963d74-ee48-4c49-819e-a34cf532f1f5"
 SpecId="1725280b-f696-4860-94cc-d85f62c35214"
 Guid="e630722a-9223-487c-b459-d6815c58ccaf"
>
</ReqRef><Comment>Revokes TSRs that have been passed by the train.</Comment>
<SubRules></SubRules>
<Conditions>
<RuleCondition
 Implemented="TRUE"
 NeedsRequirement="FALSE"
 Name="RevokeTSR"
 Guid="dfdab89f-e5d8-4c7d-bf15-649d47078a07"
>
<Comment></Comment>
<PreConditions>
<PreCondition
 Guid="8e101bfa-646f-443f-983c-1f79b9e26a10"
>THERE_IS_IN TSRs | X.Location + BaseTypes.LengthToDistance (TSRLength (X)) + DistanceToKeepInfoInTheRear &lt;= TrainPosition.RearEndPosition ( DistanceInterval.Min )</PreCondition></PreConditions>
<Actions>
<Action
 Guid="eee5f16e-cc8f-4f90-b380-617bf6f96f00"
>REMOVE ALL
  X.Location + BaseTypes.LengthToDistance (TSRLength (X)) + DistanceToKeepInfoInTheRear &lt;= TrainPosition.RearEndPosition ( DistanceInterval.Min )
IN
  TSRs</Action></Actions>
</RuleCondition></Conditions>
</Rule></Rules>
</NameSpace>
